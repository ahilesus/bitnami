{{- if $.Values.global.nginx_gw.enabled }}
{{- $ca := genCA "internal-mtls-ca" 30 -}}
{{- $server := genSignedCertWithKey "edgevault-server" nil (list (printf "*.%s.svc.cluster.local" .Release.Namespace)) 30 $ca (genPrivateKey "ecdsa") -}}
{{- $client := genSignedCertWithKey "edgevault-client" nil (list (printf "*.%s.svc.cluster.local" .Release.Namespace)) 30 $ca (genPrivateKey "ecdsa") -}}
---
apiVersion: v1
kind: Secret
metadata:
  name: eo-vault-imtls-secret
data:
  ca.crt: {{ $ca.Cert | b64enc }}
  server.crt: {{ $server.Cert | b64enc }}
  server.key: {{ $server.Key | b64enc }}
  client.crt: {{ $client.Cert | b64enc }}
  client.key: {{ $client.Key | b64enc }}
{{- end }}
